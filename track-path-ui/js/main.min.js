$(document).ready(function(){let e="";function t(e,t,a){let s=$(e);s.empty(),Object.keys(a).forEach(e=>{let t=e.replace(/_acquired$/,"");s.append($("<th>").addClass("px-6 text-left text-xs font-medium text-gray-500 uppercase tracking-wider").text(t))});let r=$(t);r.empty(),Object.values(a).forEach(e=>{r.append($("<td>").addClass("px-6 whitespace-nowrap text-sm text-gray-900").text(e))})}function a(e,t){for(let a in t.empty(),e)if(e.hasOwnProperty(a)){let s=e[a],r="PASS"===s?"text-bg-success":"WARN"===s?"text-bg-warning":"text-bg-danger",l=$("<span>").addClass(`badge ${r} m-1`).text(a);t.append(l)}}function s(e){return e.replace(/#/g,"No. ").replace(/\(.*?\)/g,e=>e.toLowerCase())}function r(e,t){let a='<div class="mb-4"><div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2">';for(let[r,l]of Object.entries(t))a+=`<div class="metric-card bg-white rounded-md shadow-sm p-2 border border-gray-200"><h3 class="text-sm font-medium text-gray-600 truncate">${s(r)}</h3><p class="text-base text-blue-500">${l.toLocaleString()}</p></div>`;return a+"</div></div>"}!function s(){!function s(){let l=data.bracken,i={};for(let n in l)if(l.hasOwnProperty(n)){let c=l[n].name;i[c]||(i[c]=[]),i[c].push(n)}for(let o in i)i.hasOwnProperty(o)&&i[o].sort();let d=Object.keys(i).sort((e,t)=>e.localeCompare(t)),p=$("#species-groups");p.empty();let m=["text-red-500","text-blue-500","text-green-500","text-yellow-500","text-purple-500","text-pink-500","text-orange-500","text-teal-500","text-indigo-500","text-cyan-500","text-lime-500","text-amber-500"],f=0;for(let b of d)if(i.hasOwnProperty(b)){let u=m[f%m.length],h=$("<div>").addClass("px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider").text(b),x=$("<div>").addClass("space-y-1");for(let y of i[b]){let g=$("<div>").addClass("sidebar-item px-4 py-2 text-sm font-medium text-gray-800 cursor-pointer flex items-center").append($("<i>").addClass("fas fa-bacterium mr-2 "+u)).append(y);x.append(g)}let v=$("<hr>").addClass("my-2 border-gray-300");p.append(v),p.append(h),p.append(x),f++}document.querySelectorAll(".sidebar-item").forEach(s=>{s.addEventListener("click",()=>{document.querySelectorAll(".sidebar-item").forEach(e=>{e.classList.remove("active")}),s.classList.add("active");let l=s.textContent.trim(),i="blue";try{let n=s.querySelector("i").classList[3];n&&(i=n.split("-")[1]||"blue")}catch(c){console.error("Error fetching icon color:",c)}$("#main-container").removeClass("hidden"),e!==l&&(e=l,$("table").each(function(){$(this).hasClass("bts-table")?$(this).bootstrapTable("removeAll"):$(this).find("td").each(function(){$(this).text("⏳")})}),$(".metric-card").each(function(){$(this).find("p").text("⏳")}),$(".kl-gi-data-holder").each(function(){$(this).text("⏳")}),$(".kl-am-data-holder").each(function(){$(this).text("⏳")}),$("#fatqc-img-fr").attr("src","https://placehold.co/600x400?text=FastQC+Forward+Reads"),$("#fatqc-img-rv").attr("src","https://placehold.co/600x400?text=FastQC+Forward+Reads"),$("#fastqc-summary-fr").empty(),$("#fastqc-summary-rv").empty(),setTimeout(()=>{(function e(s,l){var i,n,c,o,d,p,m,f,b,u,h;let x=data.bracken[s].name,y=data.mlst[s].st;if(($("#header-id").html(`Selected Isolate: <span class="text-${l}-600">${s}</span>`),$("#header-sub").empty().append(`<span class="species-badge bg-${l}-100 text-${l}-800">${x}</span><span class="ml-2 text-sm text-gray-600">ST-${y}</span>`),function e(t){if(t.hasOwnProperty("frac")){$("#bracken-frac").text(t.frac);let a=parseFloat(t.frac),s="fas fa-exclamation-circle text-red-500",r="species-badge bg-red-100 text-red-800";a>.8?(s="fas fa-check-circle text-green-500",r="species-badge bg-green-100 text-green-800"):a>=.5&&(s="fas fa-exclamation-triangle text-yellow-500",r="species-badge bg-yellow-100 text-yellow-800"),$("#bracken-frac-icon").remove(),$("#bracken-frac").append($("<i>").addClass(s).attr("id","bracken-frac-icon").addClass("ml-2")),$("#bracken-name").html(`<span class="${r}">${t.name}</span>`)}t.hasOwnProperty("taxid")&&$("#bracken-taxid").text(t.taxid),t.hasOwnProperty("lvl")&&$("#bracken-lvl").text(t.lvl),t.hasOwnProperty("kar")&&$("#bracken-kar").text(t.kar.toLocaleString()),t.hasOwnProperty("ar")&&$("#bracken-ar").text(t.ar.toLocaleString()),t.hasOwnProperty("nr")&&$("#bracken-nr").text(t.nr.toLocaleString())}(data.bracken[s]),function e(t){if($("#mlst-table-th").empty(),t.hasOwnProperty("loci")){let a=t.loci;$("#mlst-table-th").append('<th scope="col" class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Scheme</th>'),$("#mlst-table-th").append('<th scope="col" class="px-6 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ST</th>'),a.forEach(e=>{let t=$("<th>").addClass("px-6 py-2 text-left text-xs font-medium italic text-gray-700 tracking-wider").text(e);$("#mlst-table-th").append(t)})}if($("#mlst-table-td").empty(),t.hasOwnProperty("alleles")){let s=t.alleles;$("#mlst-table-td").append(`<td class="px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${t.scheme}</td>`),$("#mlst-table-td").append(`<td class="px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${t.st}</td>`),s.forEach(e=>{let t=$("<td>").addClass("px-6 py-2 whitespace-nowrap text-sm font-medium text-gray-900").text(e);$("#mlst-table-td").append(t)})}}(data.mlst[s]),data.kleborate.hasOwnProperty(s))?($("#kleborate-section").removeClass("hidden"),$("#nav-kleborate-section").removeClass("disabled"),function e(t){let{strain_and_species_identification:a,sequence_typing:s,genome_assembly_metrics:r}=t,l={...a,...s};$(".kl-gi-data-holder").each(function(){let e=$(this).data("field");if(e&&l.hasOwnProperty(e)){if("mlst_genes"===e){let t=Object.entries(l[e]).map(([e,t])=>{let a=!isNaN(t);return`<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${a?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}">${e}(${t})</span>`}).join(" ");$(this).html(t)}else if("species_match"===e){let s="strong"===l[e]?'<i class="fas fa-check-circle text-green-500 ml-2"></i>':'<i class="fas fa-exclamation-triangle text-yellow-500 ml-2"></i>',r="strong"===a.species_match?"text-green-500":"text-yellow-500";$(this).html(`<span class = 'uppercase ${r}'>${l[e]}</span> ${s}`)}else $(this).text(l[e])}}),$(".kl-am-data-holder").each(function(){let e=$(this).data("field");if(e&&r.hasOwnProperty(e)){if("ambiguous_bases"===e)"no"===r[e]?$(this).html('<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 uppercase">No <i class="fas fa-check-circle ml-1"></i></span>'):$(this).html(`<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">${r[e]} <i class="fas fa-exclamation-triangle ml-1"></i> </span>`);else if("QC_warnings"===e){if("-"===r[e])$(this).html('<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">None <i class="fas fa-check-circle ml-1"></i></span>');else{let t=r[e].split(",").map(e=>`<span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">${e.trim()} <i class="fas fa-exclamation-triangle ml-1"></i></span>`).join(" ");$(this).html(t)}}else $(this).text(r[e].toLocaleString())}})}(i=data.kleborate[s]),function e(a){acq_resis=a.antimicrobial_resistance.acquired_resistance_genes,mut_resis=a.antimicrobial_resistance.resistance_mutations,sum_resis=a.antimicrobial_resistance.resistance_summary;let s={},r={};for(let l in acq_resis)l.startsWith("Bla")?s[l]=acq_resis[l]:r[l]=acq_resis[l];t("#bla-res-table-th","#bla-res-table-td",s),t("#acq-res-table-th","#acq-res-table-td",r),t("#mut-res-table-th","#mut-res-table-td",mut_resis),t("#res-summary-table-th","#res-summary-table-td",sum_resis)}(i),yersiniabactin=(n=data.kleborate[s]).virulence_factors.yersiniabactin,colibactin=n.virulence_factors.colibactin,aerobactin=n.virulence_factors.aerobactin,salmochelin=n.virulence_factors.salmochelin,rmpadc=n.virulence_factors.rmpadc,virulence_summary=n.virulence_factors.virulence_summary,t("#yersiniabactin-table-th","#yersiniabactin-table-td",yersiniabactin.genes),t("#colibactin-table-th","#colibactin-table-td",colibactin.genes),t("#aerobactin-table-th","#aerobactin-table-td",aerobactin.genes),t("#salmochelin-table-th","#salmochelin-table-td",salmochelin.genes),t("#rmpadc-table-th","#rmpadc-table-td",rmpadc.genes),$("#yersiniabactin-st-value").text(yersiniabactin.YbST),$("#colibactin-st-value").text(colibactin.CbST),$("#aerobactin-st-value").text(aerobactin.AbST),$("#salmochelin-st-value").text(salmochelin.SmST),$("#rmpadc-st-value").text(rmpadc.RmST),$("#yersiniabactin-spurious-hits-value").text(yersiniabactin.spurious_ybt_hits),$("#colibactin-spurious-hits-value").text(colibactin.spurious_clb_hits),$("#aerobactin-spurious-hits-value").text(aerobactin.spurious_abst_hits),$("#salmochelin-spurious-hits-value").text(salmochelin.spurious_smst_hits),$("#rmpadc-spurious-hits-value").text(rmpadc.spurious_rmst_hits),$("#virulence-score-value").text(virulence_summary.virulence_score),$("#spurious-virulence-hits-value").text(virulence_summary.spurious_virulence_hits),k_locus=(c=data.kleborate[s]).capsule_and_o_antigen_typing.k_locus,o_locus=c.capsule_and_o_antigen_typing.o_locus,t("#klocus-table-th","#klocus-table-td",k_locus),t("#olocus-table-th","#olocus-table-td",o_locus)):($("#kleborate-section").addClass("hidden"),$("#nav-kleborate-section").addClass("disabled")),data.rgi&&data.rgi.hasOwnProperty(s)&&(o=JSON.parse(JSON.stringify(data.rgi[s])),$("#rgi-table").bootstrapTable("load",o)),data.amrfinder&&data.amrfinder.hasOwnProperty(s)){let g,v,w;d=JSON.parse(JSON.stringify(data.amrfinder[s])),g=$("#amrfinder-table"),v=$("#amrfinder-virulence-table"),w=$("#amrfinder-stress-table"),g.bootstrapTable("load",d.amr),v.bootstrapTable("load",d.vf),w.bootstrapTable("load",d.stress)}if(data.amrfinder_mutations&&data.amrfinder_mutations.hasOwnProperty(s)&&(p=JSON.parse(JSON.stringify(data.amrfinder_mutations[s])),$("#amrfinder-mutations-table").bootstrapTable("load",p)),data.snippy&&data.snippy.hasOwnProperty(s)){let k,q;m=JSON.parse(JSON.stringify(data.snippy[s])),k=$("#snippy-table"),q=$("#snippy-ref-genome"),k.bootstrapTable("load",m.mutations),q.html(`Reference genome: <a href="https://www.ncbi.nlm.nih.gov/nuccore/${m.reference}" target="_blank" class="text-blue-500 underline hover:text-blue-700">${m.reference}</a>`)}if(data.fastqc&&data.fastqc.hasOwnProperty(s)&&(f=JSON.parse(JSON.stringify(data.fastqc[s])),b=s,$("#fatqc-img-fr").attr("src","./img/qc/"+b+"_fr.svg"),$("#fatqc-img-rv").attr("src","./img/qc/"+b+"_rv.svg"),a(f.fr,$("#fastqc-summary-fr")),a(f.rv,$("#fastqc-summary-rv"))),data.quast&&data.quast.hasOwnProperty(s)&&function e(t){for(let[a,s]of Object.entries(t)){let l=a.replace(/_/g,"-")+"-container";$("#"+l).empty(),$("#"+l).append(r(a,s))}}(JSON.parse(JSON.stringify(data.quast[s]))),data.vfdb&&data.vfdb.hasOwnProperty(s)&&(u=JSON.parse(JSON.stringify(data.vfdb[s])),$("#vfdb-table").bootstrapTable("load",u)),data.plasmidfinder&&data.plasmidfinder.hasOwnProperty(s)){$("#plasmidfinder-section").removeClass("hidden"),$("#nav-plasmidfinder-section").removeClass("disabled");h=JSON.parse(JSON.stringify(data.plasmidfinder[s])),$("#plasmidfinder-table").bootstrapTable("load",h)}else $("#plasmidfinder-section").addClass("hidden"),$("#nav-plasmidfinder-section").addClass("disabled");let C=document.querySelectorAll('[data-bs-spy="scroll"]');C.forEach(e=>{bootstrap.ScrollSpy.getInstance(e).refresh()})})(l,i)},100));let o=document.querySelector(".flex-1");o.classList.add("opacity-50"),setTimeout(()=>{o.classList.remove("opacity-50")},500)})})}(),document.querySelectorAll(".tab-button").forEach(e=>{e.addEventListener("click",()=>{let t=e.closest(".tab-container");t.querySelectorAll(".tab-button").forEach(e=>{e.classList.remove("active")}),t.querySelectorAll(".tab-content").forEach(e=>{e.classList.remove("active")}),e.classList.add("active");let a=e.getAttribute("data-tab"),s=document.getElementById(`${a}-tab`);s&&s.classList.add("active")})});let l=document.querySelector(".sidebar-item");l&&l.click()}()});